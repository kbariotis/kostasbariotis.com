{"data":{"site":{"siteMetadata":{"title":"Kostas Bariotis' Blog","description":"Senior full stack engineer <a href=\"https://geekbot.io\">@geekbot_io</a>, co-organizer of <a href=\"https://devitconf.org\">@devitconf</a> & <a href=\"https://www.meetup.com/Thessaloniki-Node-js-Meetup/\">@skgnodejs</a>, host of <a href=\"http://devastation.tv\">Devastation Podcast</a>.","siteUrl":"https://kostasbariotis.com"}}},"pageContext":{"jsonName":"tag-mongoose-431","internalComponentName":"ComponentTagMongoose","path":"/tag/mongoose","component":"/home/travis/build/kbariotis/kostasbariotis.com/src/templates/tags.js","componentChunkName":"component---src-templates-tags-js","context":{"posts":[{"excerpt":"Today I lost a few hours trying to understand why a document that I was fetching through Mongoose, kept returning true against checking for a field with the   operator, even though the document didn't contain that field. But still it would return…","html":"<p>Today I lost a few hours trying to understand why a document that I was fetching through Mongoose, kept returning true against checking for a field with the <code class=\"language-text\">in</code> operator, even though the document didn't contain that field.</p>\n<p>But still it would return true:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\">\n      <pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> mongoose <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mongoose'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  Schema <span class=\"token operator\">=</span> mongoose<span class=\"token punctuation\">.</span>Schema<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> exampleSchema <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Schema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  someField<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">,</span>\n  notExistingField<span class=\"token punctuation\">:</span> String\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> versionKey<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* We know that this document doesn't have the notExistingField in the DB */</span>\nexampleSchema<span class=\"token punctuation\">.</span><span class=\"token function\">findOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'_id'</span><span class=\"token punctuation\">:</span> id\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">)</span> <span class=\"token comment\">/* { someField: 'value' } */</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">[</span><span class=\"token string\">'notExistingField'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">/* undefined */</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'notExistingField'</span> <span class=\"token keyword\">in</span> document<span class=\"token punctuation\">)</span> <span class=\"token comment\">/* true */</span>\n\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p>The fact is that Mongoose will first comply the fetched document against the defined Schema in order for it's getters/setters functions to work. So even though, we can't see the <code class=\"language-text\">notExistingField</code>, the <code class=\"language-text\">in</code> operator will always return true.</p>\n<p>A solution is to change the checking and check for an undefined value, like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\">\n      <pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/* We know that this document doesn't have the notExistingField in the DB */</span>\nexampleSchema<span class=\"token punctuation\">.</span><span class=\"token function\">findOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'_id'</span><span class=\"token punctuation\">:</span> id\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">)</span> <span class=\"token comment\">/* { someField: 'value' } */</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">[</span><span class=\"token string\">'notExistingField'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">/* undefined */</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span>document<span class=\"token punctuation\">[</span><span class=\"token string\">'notExistingField'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">/* false */</span>\n\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p>Fixed.</p>","id":"a73a850a-eae6-5837-94dc-f710ee2619f3","timeToRead":1,"frontmatter":{"date":"2015-08-31T17:51:38.000Z","path":"/mongoose-objects-and-the-in-operator/","tags":"mongodb, mongoose","title":"Mongoose objects and the IN operator","draft":null}}],"tag":"mongoose","pagesSum":1,"page":1},"updatedAt":1529439934493,"pluginCreator___NODE":"Plugin default-site-plugin","pluginCreatorId":"Plugin default-site-plugin","componentPath":"/home/travis/build/kbariotis/kostasbariotis.com/src/templates/tags.js","posts":[{"excerpt":"Today I lost a few hours trying to understand why a document that I was fetching through Mongoose, kept returning true against checking for a field with the   operator, even though the document didn't contain that field. But still it would return…","html":"<p>Today I lost a few hours trying to understand why a document that I was fetching through Mongoose, kept returning true against checking for a field with the <code class=\"language-text\">in</code> operator, even though the document didn't contain that field.</p>\n<p>But still it would return true:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\">\n      <pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> mongoose <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mongoose'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  Schema <span class=\"token operator\">=</span> mongoose<span class=\"token punctuation\">.</span>Schema<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> exampleSchema <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Schema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  someField<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">,</span>\n  notExistingField<span class=\"token punctuation\">:</span> String\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> versionKey<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/* We know that this document doesn't have the notExistingField in the DB */</span>\nexampleSchema<span class=\"token punctuation\">.</span><span class=\"token function\">findOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'_id'</span><span class=\"token punctuation\">:</span> id\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">)</span> <span class=\"token comment\">/* { someField: 'value' } */</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">[</span><span class=\"token string\">'notExistingField'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">/* undefined */</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'notExistingField'</span> <span class=\"token keyword\">in</span> document<span class=\"token punctuation\">)</span> <span class=\"token comment\">/* true */</span>\n\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p>The fact is that Mongoose will first comply the fetched document against the defined Schema in order for it's getters/setters functions to work. So even though, we can't see the <code class=\"language-text\">notExistingField</code>, the <code class=\"language-text\">in</code> operator will always return true.</p>\n<p>A solution is to change the checking and check for an undefined value, like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\">\n      <pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">/* We know that this document doesn't have the notExistingField in the DB */</span>\nexampleSchema<span class=\"token punctuation\">.</span><span class=\"token function\">findOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'_id'</span><span class=\"token punctuation\">:</span> id\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">)</span> <span class=\"token comment\">/* { someField: 'value' } */</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">[</span><span class=\"token string\">'notExistingField'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">/* undefined */</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token operator\">!</span>document<span class=\"token punctuation\">[</span><span class=\"token string\">'notExistingField'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">/* false */</span>\n\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre>\n      </div>\n<p>Fixed.</p>","id":"a73a850a-eae6-5837-94dc-f710ee2619f3","timeToRead":1,"frontmatter":{"date":"2015-08-31T17:51:38.000Z","path":"/mongoose-objects-and-the-in-operator/","tags":"mongodb, mongoose","title":"Mongoose objects and the IN operator","draft":null}}],"tag":"mongoose","pagesSum":1,"page":1}}